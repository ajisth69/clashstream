<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClashStream - Music Streaming</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-tertiary: #121212;
            --bg-elevated: #181818;
            --bg-highlight: #282828;
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --neon-green: #1DB954;
            --neon-cyan: #00D4FF;
            --neon-magenta: #FF006E;
            --neon-purple: #8B5CF6;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --text-muted: #6a6a6a;
            --sidebar-width: 240px;
            --player-height: 90px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        /* App Layout */
        .app-container {
            display: grid;
            grid-template-columns: var(--sidebar-width) 1fr;
            grid-template-rows: 1fr var(--player-height);
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            background: var(--bg-secondary);
            grid-row: 1 / 2;
            display: flex;
            flex-direction: column;
            padding: 16px 12px;
            gap: 8px;
            border-right: 1px solid var(--glass-border);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-magenta));
            
            -webkit-text-fill-color: transparent;
            padding: 8px 12px 24px;
            letter-spacing: -0.5px;
        }

        .nav-section {
            margin-bottom: 16px;
        }

        .nav-title {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            padding: 8px 12px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 16px;
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .nav-item:hover {
            background: var(--glass-bg);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--bg-highlight);
            color: var(--text-primary);
        }

        .nav-item svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
            flex-shrink: 0;
        }

        .queue-preview {
            flex: 1;
            overflow-y: auto;
            margin-top: 8px;
            padding: 8px;
            background: var(--glass-bg);
            border-radius: 12px;
        }

        .queue-preview-title {
            font-size: 0.75rem;
            color: var(--text-muted);
            padding: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .queue-count {
            background: var(--neon-purple);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.65rem;
        }

        .mini-queue-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .mini-queue-item:hover {
            background: var(--bg-highlight);
        }

        .mini-queue-item.playing {
            background: rgba(29, 185, 84, 0.15);
        }

        .mini-queue-thumb {
            width: 36px;
            height: 36px;
            border-radius: 4px;
            object-fit: cover;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple));
        }

        .mini-queue-info {
            flex: 1;
            overflow: hidden;
        }

        .mini-queue-title {
            font-size: 0.75rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .mini-queue-artist {
            font-size: 0.65rem;
            color: var(--text-muted);
        }

        /* Main Content */
        .main-content {
            grid-row: 1 / 2;
            background: linear-gradient(180deg, #1a1a2e 0%, var(--bg-primary) 30%);
            overflow-y: auto;
            padding: 24px 32px;
            position: relative;
        }

        /* Dynamic background that will be updated via JS */
        .ambient-bg {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 400px;
            background: radial-gradient(ellipse at 30% 0%, rgba(0, 212, 255, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 0%, rgba(255, 0, 110, 0.1) 0%, transparent 50%);
            pointer-events: none;
            transition: background 1s ease;
            z-index: 0;
        }

        .content-wrapper {
            position: relative;
            z-index: 1;
        }

        /* Search Bar */
        .search-container {
            margin-bottom: 32px;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: var(--bg-highlight);
            border-radius: 500px;
            padding: 4px;
            max-width: 500px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .search-box:focus-within {
            border-color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        .search-icon {
            padding: 12px 16px;
            display: flex;
            align-items: center;
        }

        .search-icon svg {
            width: 20px;
            height: 20px;
            fill: var(--text-secondary);
        }

        .search-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 0.9rem;
            padding: 12px 0;
            outline: none;
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        /* Discovery Section */
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .discover-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .discover-card {
            aspect-ratio: 1;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        .discover-card:hover {
            transform: scale(1.03);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .discover-card h3 {
            font-size: 1.3rem;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }

        .discover-card p {
            font-size: 0.8rem;
            opacity: 0.8;
            position: relative;
            z-index: 1;
        }

        .discover-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, transparent 40%, rgba(0, 0, 0, 0.8) 100%);
        }

        .card-chill {
            background: linear-gradient(135deg, #1DB954, #134e5e);
        }

        .card-energy {
            background: linear-gradient(135deg, #FF006E, #8B5CF6);
        }

        .card-focus {
            background: linear-gradient(135deg, #00D4FF, #0066FF);
        }

        .card-party {
            background: linear-gradient(135deg, #FFD700, #FF6B00);
        }

        .card-lofi {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .card-rock {
            background: linear-gradient(135deg, #CC2B5E, #753a88);
        }

        /* Now Playing Section */
        .now-playing-section {
            display: none;
            margin-bottom: 40px;
        }

        .now-playing-section.active {
            display: block;
        }

        .now-playing-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 40px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 24px;
        }

        .album-art-wrapper {
            position: relative;
        }

        .album-art {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 12px;
            object-fit: cover;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple));
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        /* Visualizer */
        .visualizer-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 3px;
            padding: 0 20px 10px;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.6));
            border-radius: 0 0 12px 12px;
        }

        .visualizer-bar {
            width: 4px;
            background: linear-gradient(to top, var(--neon-green), var(--neon-cyan));
            border-radius: 2px;
            transition: height 0.1s ease;
        }

        .track-details {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .track-details .track-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .track-details .track-artist {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .track-actions {
            display: flex;
            gap: 12px;
            margin-top: auto;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 500px;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .action-btn svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        .action-btn.primary {
            background: var(--neon-green);
            color: #000;
        }

        .action-btn.primary:hover {
            transform: scale(1.05);
            background: #1ed760;
        }

        .action-btn.secondary {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--text-secondary);
        }

        .action-btn.secondary:hover {
            border-color: var(--text-primary);
        }

        /* Song List */
        .song-list-section {
            margin-top: 24px;
        }

        .song-list {
            display: flex;
            flex-direction: column;
        }

        .song-item {
            display: grid;
            grid-template-columns: 50px 1fr auto auto;
            align-items: center;
            gap: 16px;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .song-item:hover {
            background: var(--glass-bg);
        }

        .song-item.playing {
            background: rgba(29, 185, 84, 0.1);
        }

        .song-thumb {
            width: 50px;
            height: 50px;
            border-radius: 6px;
            object-fit: cover;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple));
        }

        .song-info {
            overflow: hidden;
        }

        .song-title {
            font-size: 0.95rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .song-artist {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .song-duration {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .add-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid var(--glass-border);
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.2s;
        }

        .song-item:hover .add-btn {
            opacity: 1;
        }

        .add-btn:hover {
            border-color: var(--neon-green);
            background: rgba(29, 185, 84, 0.1);
        }

        .add-btn svg {
            width: 16px;
            height: 16px;
            fill: var(--text-secondary);
        }

        /* Loading & States */
        .loading-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 100;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 20px;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--bg-highlight);
            border-top-color: var(--neon-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            color: var(--text-secondary);
        }

        /* Welcome State */
        .welcome-state {
            text-align: center;
            padding: 60px 20px;
        }

        .welcome-state svg {
            width: 80px;
            height: 80px;
            fill: var(--text-muted);
            margin-bottom: 24px;
            opacity: 0.5;
        }

        .welcome-state h2 {
            font-size: 1.5rem;
            margin-bottom: 12px;
        }

        .welcome-state p {
            color: var(--text-secondary);
        }

        /* Bottom Player */
        .player-bar {
            grid-column: 1 / -1;
            background: linear-gradient(to top, #000, var(--bg-tertiary));
            border-top: 1px solid var(--glass-border);
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            align-items: center;
            padding: 0 24px;
        }

        .player-track {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .player-thumb {
            width: 56px;
            height: 56px;
            border-radius: 6px;
            object-fit: cover;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple));
        }

        .player-info {
            overflow: hidden;
        }

        .player-info .player-title {
            font-size: 0.9rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .player-info .player-artist {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .player-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .control-buttons {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .ctrl-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ctrl-btn svg {
            width: 20px;
            height: 20px;
            fill: var(--text-secondary);
            transition: fill 0.2s;
        }

        .ctrl-btn:hover svg {
            fill: var(--text-primary);
        }

        .play-pause-btn {
            width: 40px;
            height: 40px;
            background: var(--text-primary);
            border-radius: 50%;
        }

        .play-pause-btn svg {
            fill: #000 !important;
            width: 18px;
            height: 18px;
        }

        .play-pause-btn:hover {
            transform: scale(1.08);
        }

        .progress-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            max-width: 600px;
        }

        .time-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            width: 40px;
        }

        .time-label:last-child {
            text-align: right;
        }

        .progress-bar {
            flex: 1;
            height: 4px;
            background: var(--bg-highlight);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }

        .progress-bar:hover {
            height: 6px;
        }

        .progress-fill {
            height: 100%;
            background: var(--text-primary);
            border-radius: 2px;
            width: 0%;
            position: relative;
            transition: background 0.2s;
        }

        .progress-bar:hover .progress-fill {
            background: var(--neon-green);
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: var(--text-primary);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .progress-bar:hover .progress-fill::after {
            opacity: 1;
        }

        .player-extra {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 16px;
        }

        .extra-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 8px;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .extra-btn:hover {
            opacity: 1;
        }

        .extra-btn.active {
            opacity: 1;
        }

        .extra-btn.active svg {
            fill: var(--neon-green);
        }

        .extra-btn svg {
            width: 18px;
            height: 18px;
            fill: var(--text-primary);
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .volume-slider {
            width: 100px;
            height: 4px;
            background: var(--bg-highlight);
            border-radius: 2px;
            cursor: pointer;
            appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            appearance: none;
            width: 12px;
            height: 12px;
            background: var(--text-primary);
            border-radius: 50%;
            cursor: pointer;
        }

        /* Keyboard Shortcut Hint */
        .shortcut-hint {
            position: fixed;
            bottom: 110px;
            right: 24px;
            background: var(--bg-elevated);
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.8rem;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            z-index: 50;
            border: 1px solid var(--glass-border);
        }

        .shortcut-hint.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* History Sidebar */
        .history-panel {
            position: fixed;
            top: 0;
            right: -350px;
            width: 350px;
            height: calc(100% - var(--player-height));
            background: var(--bg-secondary);
            border-left: 1px solid var(--glass-border);
            transition: right 0.3s ease;
            z-index: 60;
            padding: 24px;
            overflow-y: auto;
        }

        .history-panel.open {
            right: 0;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .history-header h3 {
            font-size: 1.2rem;
        }

        .close-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 8px;
        }

        .close-btn svg {
            width: 20px;
            height: 20px;
            fill: var(--text-secondary);
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .history-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .history-item:hover {
            background: var(--glass-bg);
        }

        .history-thumb {
            width: 44px;
            height: 44px;
            border-radius: 4px;
            object-fit: cover;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple));
        }

        .history-info {
            flex: 1;
            overflow: hidden;
        }

        .history-title {
            font-size: 0.85rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-artist {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        audio {
            display: none;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .app-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                display: none;
            }

            .now-playing-container {
                grid-template-columns: 200px 1fr;
            }
        }

        @media (max-width: 768px) {
            .now-playing-container {
                grid-template-columns: 1fr;
            }

            .player-bar {
                grid-template-columns: 1fr 1fr;
            }

            .player-extra {
                display: none;
            }

            .discover-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">ClashStream</div>
            <nav class="nav-section">
                <div class="nav-item active" id="navHome">
                    <svg viewBox="0 0 24 24">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                    </svg>
                    Home
                </div>
                <div class="nav-item" id="navSearch">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
                    </svg>
                    Search
                </div>
                <div class="nav-item" id="navHistory">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M13 3a9 9 0 0 0-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.954 8.954 0 0 0 13 21a9 9 0 0 0 0-18zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z" />
                    </svg>
                    History
                </div>
            </nav>
            <div class="queue-preview">
                <div class="queue-preview-title">
                    Queue <span class="queue-count" id="sidebarQueueCount">0</span>
                </div>
                <div id="sidebarQueue"></div>
            </div>
        </aside>
        <!-- Main Content -->
        <main class="main-content">
            <div class="ambient-bg" id="ambientBg"></div>
            <div class="content-wrapper">
                <div class="search-container">
                    <div class="search-box">
                        <div class="search-icon">
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
                            </svg>
                        </div>
                        <input type="text" class="search-input" id="searchInput"
                            placeholder="What do you want to listen to?">
                    </div>
                </div>
                <!-- Welcome / Discover -->
                <section id="welcomeSection">
                    <h2 class="section-title">Discover</h2>
                    <div class="discover-grid">
                        <div class="discover-card card-chill" data-query="chill vibes lofi">
                            <h3>Chill</h3>
                            <p>Relax and unwind</p>
                        </div>
                        <div class="discover-card card-energy" data-query="workout energy pump">
                            <h3>Energy</h3>
                            <p>Get pumped up</p>
                        </div>
                        <div class="discover-card card-focus" data-query="focus study concentration">
                            <h3>Focus</h3>
                            <p>Deep concentration</p>
                        </div>
                        <div class="discover-card card-party" data-query="party dance hits">
                            <h3>Party</h3>
                            <p>Dance all night</p>
                        </div>
                        <div class="discover-card card-lofi" data-query="lofi hip hop beats">
                            <h3>Lo-Fi</h3>
                            <p>Beats to study to</p>
                        </div>
                        <div class="discover-card card-rock" data-query="rock classics">
                            <h3>Rock</h3>
                            <p>Classic anthems</p>
                        </div>
                    </div>
                    <div class="welcome-state" id="welcomeState">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z" />
                        </svg>
                        <h2>Start Listening</h2>
                        <p>Search for songs, artists, or albums above</p>
                    </div>
                </section>
                <!-- Now Playing -->
                <section class="now-playing-section" id="nowPlayingSection">
                    <h2 class="section-title">Now Playing</h2>
                    <div class="now-playing-container">
                        <div class="album-art-wrapper">
                            <img class="album-art" id="albumArt" src="" alt="Album Art">
                            <div class="visualizer-container" id="visualizer"></div>
                        </div>
                        <div class="track-details">
                            <h1 class="track-title" id="trackTitle">Track Title</h1>
                            <p class="track-artist" id="trackArtist">Artist</p>
                            <div class="track-actions">
                                <button class="action-btn primary" id="addToQueueBtn">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                                    </svg>
                                    Add to Queue
                                </button>
                                <button class="action-btn secondary" id="lyricsBtn">
                                    <svg viewBox="0 0 24 24">
                                        <path
                                            d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z" />
                                    </svg>
                                    Lyrics
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- Search Results / Queue -->
                    <div class="song-list-section">
                        <h2 class="section-title">Search Results</h2>
                        <div class="song-list" id="songList"></div>
                    </div>
                </section>
            </div>
        </main>
        <!-- Bottom Player -->
        <footer class="player-bar">
            <div class="player-track">
                <img class="player-thumb" id="playerThumb" src="" alt="">
                <div class="player-info">
                    <div class="player-title" id="playerTitle">Not Playing</div>
                    <div class="player-artist" id="playerArtist">-</div>
                </div>
            </div>
            <div class="player-controls">
                <div class="control-buttons">
                    <button class="ctrl-btn" id="shuffleBtn" title="Shuffle">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z" />
                        </svg>
                    </button>
                    <button class="ctrl-btn" id="prevBtn" title="Previous">
                        <svg viewBox="0 0 24 24">
                            <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z" />
                        </svg>
                    </button>
                    <button class="ctrl-btn play-pause-btn" id="playBtn" title="Play">
                        <svg viewBox="0 0 24 24" id="playIcon">
                            <path d="M8 5v14l11-7z" />
                        </svg>
                    </button>
                    <button class="ctrl-btn" id="nextBtn" title="Next">
                        <svg viewBox="0 0 24 24">
                            <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z" />
                        </svg>
                    </button>
                    <button class="ctrl-btn extra-btn active" id="infiniteVibeBtn" title="Infinite Vibe">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M18.6 6.62c-1.44 0-2.8.56-3.77 1.53L12 10.66 10.48 12h.01L7.8 14.39c-.64.64-1.49.99-2.4.99-1.87 0-3.39-1.51-3.39-3.38S3.53 8.62 5.4 8.62c.91 0 1.76.35 2.44 1.03l1.13 1 1.51-1.34L9.22 8.2A5.37 5.37 0 0 0 5.4 6.62C2.42 6.62 0 9.04 0 12s2.42 5.38 5.4 5.38c1.44 0 2.8-.56 3.77-1.53l2.83-2.5.01.01L13.52 12h-.01l2.69-2.39c.64-.64 1.49-.99 2.4-.99 1.87 0 3.39 1.51 3.39 3.38s-1.52 3.38-3.39 3.38c-.9 0-1.76-.35-2.44-1.03l-1.14-1.01-1.51 1.34 1.27 1.12a5.386 5.386 0 0 0 3.82 1.57c2.98 0 5.4-2.41 5.4-5.38s-2.42-5.37-5.4-5.37z" />
                        </svg>
                    </button>
                </div>
                <div class="progress-wrapper">
                    <span class="time-label" id="currentTime">0:00</span>
                    <div class="progress-bar" id="progressBar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <span class="time-label" id="totalTime">0:00</span>
                </div>
            </div>
            <div class="player-extra">
                <button class="extra-btn" id="historyBtn" title="History">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M13 3a9 9 0 0 0-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.954 8.954 0 0 0 13 21a9 9 0 0 0 0-18zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z" />
                    </svg>
                </button>
                <div class="volume-control">
                    <svg viewBox="0 0 24 24" style="width:18px;height:18px;fill:var(--text-secondary)">
                        <path
                            d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z" />
                    </svg>
                    <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="80">
                </div>
            </div>
        </footer>
    </div>
    <!-- History Panel -->
    <div class="history-panel" id="historyPanel">
        <div class="history-header">
            <h3>Recently Played</h3>
            <button class="close-btn" id="closeHistory">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                </svg>
            </button>
        </div>
        <div class="history-list" id="historyList"></div>
    </div>
    <!-- Loading -->
    <div class="loading-overlay" id="loadingState">
        <div class="spinner"></div>
        <p class="loading-text">Finding your track...</p>
    </div>
    <!-- Shortcut Hint -->
    <div class="shortcut-hint" id="shortcutHint">Space: Play/Pause | ←→: Seek | N: Next | P: Prev</div>
    <audio id="audioPlayer"></audio>
    <script>
        // DOM Elements
        const searchInput = document.getElementById('searchInput');
        const welcomeSection = document.getElementById('welcomeSection');
        const nowPlayingSection = document.getElementById('nowPlayingSection');
        const loadingState = document.getElementById('loadingState');
        const albumArt = document.getElementById('albumArt');
        const trackTitle = document.getElementById('trackTitle');
        const trackArtist = document.getElementById('trackArtist');
        const audioPlayer = document.getElementById('audioPlayer');
        const playBtn = document.getElementById('playBtn');
        const playIcon = document.getElementById('playIcon');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const currentTimeEl = document.getElementById('currentTime');
        const totalTimeEl = document.getElementById('totalTime');
        const volumeSlider = document.getElementById('volumeSlider');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const songList = document.getElementById('songList');
        const playerThumb = document.getElementById('playerThumb');
        const playerTitle = document.getElementById('playerTitle');
        const playerArtist = document.getElementById('playerArtist');
        const infiniteVibeBtn = document.getElementById('infiniteVibeBtn');
        const historyPanel = document.getElementById('historyPanel');
        const historyList = document.getElementById('historyList');
        const historyBtn = document.getElementById('historyBtn');
        const closeHistory = document.getElementById('closeHistory');
        const sidebarQueue = document.getElementById('sidebarQueue');
        const sidebarQueueCount = document.getElementById('sidebarQueueCount');
        const visualizer = document.getElementById('visualizer');
        const ambientBg = document.getElementById('ambientBg');
        const shortcutHint = document.getElementById('shortcutHint');

        // State
        let isPlaying = false;
        let queue = [];
        let currentTrack = null;
        let searchResults = [];
        let infiniteVibeEnabled = true;
        let history = JSON.parse(localStorage.getItem('clashstream_history') || '[]');
        const fallbackQueries = ['lofi beats', 'chill music', 'ambient', 'synthwave', 'jazz'];

        // Init
        audioPlayer.volume = 0.8;
        initVisualizer();
        updateHistoryUI();

        // Visualizer
        function initVisualizer() {
            for (let i = 0; i < 20; i++) {
                const bar = document.createElement('div');
                bar.className = 'visualizer-bar';
                bar.style.height = '4px';
                visualizer.appendChild(bar);
            }
        }

        function animateVisualizer() {
            if (!isPlaying) return;
            const bars = visualizer.querySelectorAll('.visualizer-bar');
            bars.forEach(bar => {
                const height = Math.random() * 40 + 4;
                bar.style.height = `${height}px`;
            });
            requestAnimationFrame(() => setTimeout(animateVisualizer, 100));
        }

        // Format time
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Show/hide states
        function showLoading(show) {
            loadingState.classList.toggle('active', show);
        }

        function showPlayer() {
            welcomeSection.style.display = 'none';
            nowPlayingSection.classList.add('active');
        }

        // Update UI
        function updatePlayerUI(track) {
            trackTitle.textContent = track.title;
            trackArtist.textContent = track.channel;
            playerTitle.textContent = track.title;
            playerArtist.textContent = track.channel;
            if (track.thumbnail) {
                albumArt.src = track.thumbnail;
                playerThumb.src = track.thumbnail;
            }
            totalTimeEl.textContent = formatTime(track.duration);
        }

        function updateQueueUI() {
            sidebarQueueCount.textContent = queue.length;
            if (queue.length === 0) {
                sidebarQueue.innerHTML = '<p style="font-size:0.75rem;color:var(--text-muted);padding:8px">Queue is empty</p>';
                return;
            }
            sidebarQueue.innerHTML = queue.map((t, i) => `
                <div class="mini-queue-item ${currentTrack?.id === t.id ? 'playing' : ''}" data-index="${i}">
                    <img class="mini-queue-thumb" src="${t.thumbnail || ''}" alt="">
                    <div class="mini-queue-info">
                        <div class="mini-queue-title">${t.title}</div>
                        <div class="mini-queue-artist">${t.channel}</div>
                    </div>
                </div>
            `).join('');
            sidebarQueue.querySelectorAll('.mini-queue-item').forEach(item => {
                item.addEventListener('click', () => playFromQueue(parseInt(item.dataset.index)));
            });
        }

        function updateSongListUI() {
            if (!searchResults.length) { songList.innerHTML = ''; return; }
            songList.innerHTML = searchResults.map((t, i) => `
                <div class="song-item" data-id="${t.id}">
                    <img class="song-thumb" src="${t.thumbnail || ''}" alt="">
                    <div class="song-info">
                        <div class="song-title">${t.title}</div>
                        <div class="song-artist">${t.channel}</div>
                    </div>
                    <span class="song-duration">${formatTime(t.duration)}</span>
                    <button class="add-btn" data-index="${i}" title="Add to Queue">
                        <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                    </button>
                </div>
            `).join('');
            songList.querySelectorAll('.song-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    if (!e.target.closest('.add-btn')) playTrackById(item.dataset.id);
                });
            });
            songList.querySelectorAll('.add-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const t = searchResults[parseInt(btn.dataset.index)];
                    if (t && !queue.find(q => q.id === t.id)) {
                        queue.push(t);
                        updateQueueUI();
                    }
                });
            });
        }

        function updateHistoryUI() {
            historyList.innerHTML = history.map((t, i) => `
                <div class="history-item" data-id="${t.id}">
                    <img class="history-thumb" src="${t.thumbnail || ''}" alt="">
                    <div class="history-info">
                        <div class="history-title">${t.title}</div>
                        <div class="history-artist">${t.channel}</div>
                    </div>
                </div>
            `).join('');
            historyList.querySelectorAll('.history-item').forEach(item => {
                item.addEventListener('click', () => playTrackById(item.dataset.id));
            });
        }

        function addToHistory(track) {
            history = history.filter(t => t.id !== track.id);
            history.unshift(track);
            if (history.length > 15) history.pop();
            localStorage.setItem('clashstream_history', JSON.stringify(history));
            updateHistoryUI();
        }

        // Play functions
        async function playTrackById(videoId) {
            showLoading(true);
            try {
                const res = await fetch(`/play/${videoId}`);
                const data = await res.json();
                if (!res.ok || data.error) throw new Error(data.error);
                currentTrack = data;
                updatePlayerUI(data);
                audioPlayer.src = data.audioUrl;
                showPlayer();
                showLoading(false);
                await audioPlayer.play();
                isPlaying = true;
                updatePlayIcon();
                updateQueueUI();
                addToHistory(data);
                animateVisualizer();
            } catch (e) {
                console.error(e);
                showLoading(false);
            }
        }

        async function playFromQueue(index) {
            if (index >= 0 && index < queue.length) {
                await playTrackById(queue[index].id);
            }
        }

        async function playNext() {
            if (queue.length > 0) {
                const next = queue.shift();
                updateQueueUI();
                await playTrackById(next.id);
            } else if (infiniteVibeEnabled && searchResults.length > 0) {
                const rand = searchResults[Math.floor(Math.random() * searchResults.length)];
                await playTrackById(rand.id);
            }
        }

        async function search(query) {
            if (!query.trim()) return;
            showLoading(true);
            try {
                const res = await fetch(`/search?query=${encodeURIComponent(query)}`);
                const data = await res.json();
                if (!res.ok || data.error) throw new Error(data.error);
                currentTrack = data;
                updatePlayerUI(data);
                audioPlayer.src = data.audioUrl;
                showPlayer();
                showLoading(false);
                await audioPlayer.play();
                isPlaying = true;
                updatePlayIcon();
                addToHistory(data);
                animateVisualizer();
                fetchMoreResults(query);
            } catch (e) {
                console.error(e);
                showLoading(false);
            }
        }

        async function fetchMoreResults(query) {
            try {
                const res = await fetch(`/search-list?query=${encodeURIComponent(query)}&count=10`);
                const data = await res.json();
                if (data.tracks) { searchResults = data.tracks; updateSongListUI(); }
            } catch (e) { console.error(e); }
        }

        function updatePlayIcon() {
            playIcon.innerHTML = isPlaying
                ? '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>'
                : '<path d="M8 5v14l11-7z"/>';
        }

        function togglePlay() {
            if (isPlaying) { audioPlayer.pause(); }
            else { audioPlayer.play(); animateVisualizer(); }
            isPlaying = !isPlaying;
            updatePlayIcon();
        }

        // Event Listeners
        searchInput.addEventListener('keypress', e => { if (e.key === 'Enter') search(searchInput.value); });
        playBtn.addEventListener('click', togglePlay);
        nextBtn.addEventListener('click', playNext);
        prevBtn.addEventListener('click', () => {
            if (audioPlayer.currentTime > 3) audioPlayer.currentTime = 0;
            else if (queue.length > 0) playFromQueue(queue.length - 1);
        });
        infiniteVibeBtn.addEventListener('click', () => {
            infiniteVibeEnabled = !infiniteVibeEnabled;
            infiniteVibeBtn.classList.toggle('active', infiniteVibeEnabled);
        });
        historyBtn.addEventListener('click', () => historyPanel.classList.add('open'));
        closeHistory.addEventListener('click', () => historyPanel.classList.remove('open'));
        document.getElementById('navHistory').addEventListener('click', () => historyPanel.classList.toggle('open'));
        document.querySelectorAll('.discover-card').forEach(card => {
            card.addEventListener('click', () => {
                searchInput.value = card.dataset.query;
                search(card.dataset.query);
            });
        });
        document.getElementById('addToQueueBtn').addEventListener('click', () => {
            if (currentTrack && !queue.find(q => q.id === currentTrack.id)) {
                queue.push(currentTrack);
                updateQueueUI();
            }
        });
        // Audio events
        audioPlayer.addEventListener('timeupdate', () => {
            const pct = (audioPlayer.currentTime / audioPlayer.duration) * 100;
            progressFill.style.width = `${pct}%`;
            currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
        });
        audioPlayer.addEventListener('loadedmetadata', () => {
            totalTimeEl.textContent = formatTime(audioPlayer.duration);
        });
        audioPlayer.addEventListener('ended', () => { isPlaying = false; updatePlayIcon(); playNext(); });
        audioPlayer.addEventListener('play', () => { isPlaying = true; updatePlayIcon(); animateVisualizer(); });
        audioPlayer.addEventListener('pause', () => { isPlaying = false; updatePlayIcon(); });
        progressBar.addEventListener('click', e => {
            const rect = progressBar.getBoundingClientRect();
            audioPlayer.currentTime = ((e.clientX - rect.left) / rect.width) * audioPlayer.duration;
        });
        volumeSlider.addEventListener('input', e => { audioPlayer.volume = e.target.value / 100; });
        // Keyboard shortcuts
        document.addEventListener('keydown', e => {
            if (e.target.tagName === 'INPUT') return;
            switch (e.code) {
                case 'Space': e.preventDefault(); togglePlay(); break;
                case 'ArrowRight': audioPlayer.currentTime += 10; break;
                case 'ArrowLeft': audioPlayer.currentTime -= 10; break;
                case 'ArrowUp': e.preventDefault(); audioPlayer.volume = Math.min(1, audioPlayer.volume + 0.1); volumeSlider.value = audioPlayer.volume * 100; break;
                case 'ArrowDown': e.preventDefault(); audioPlayer.volume = Math.max(0, audioPlayer.volume - 0.1); volumeSlider.value = audioPlayer.volume * 100; break;
                case 'KeyN': playNext(); break;
                case 'KeyP': prevBtn.click(); break;
            }
        });
        // Show shortcut hint on first load
        setTimeout(() => { shortcutHint.classList.add('show'); setTimeout(() => shortcutHint.classList.remove('show'), 4000); }, 2000);
    </script>
</body>

</html>